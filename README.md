# 整合性確認アプリ

経営戦略とサステナビリティの整合性を評価するWebアプリケーションです。問題データはデータベースから自動で読み込まれます。

## セットアップ手順

### 1. 依存関係のインストール
```bash
npm install
```

### 2. データベースの初期化と問題データの読み込み

#### 2.1 CSVファイルの準備
問題データのCSVファイルを準備してください。フォーマットは以下の通りです：
```csv
経営戦略文1,サステナビリティ取り組み文1
経営戦略文2,サステナビリティ取り組み文2
...
```

#### 2.2 データベースへの読み込み
```bash
node loadDataToDatabase.js <CSVファイルのパス>
```

例：
```bash
node loadDataToDatabase.js ./data/problems.csv
```

### 3. サーバーの起動
```bash
npm start
```

開発モードで起動する場合：
```bash
npm run dev
```

## 使用方法

1. ブラウザで `http://localhost:3000` にアクセス
2. ユーザー名を英数字で入力
3. 「評価を開始」ボタンをクリック
4. 表示される経営戦略とサステナビリティの組み合わせについて、1-5のスケールで整合性を評価
5. 全ての問題に回答すると完了画面が表示される

## データベース仕様

### problems テーブル
- `id`: 問題ID（自動増分）
- `strategy_text`: 経営戦略文
- `sustainability_text`: サステナビリティ取り組み文
- `created_at`: 作成日時

### sorted テーブル（評価結果）
- `id`: 評価ID（自動増分）
- `userName`: ユーザー名
- `strategyText`: 経営戦略文
- `sustainabilityText`: サステナビリティ取り組み文
- `combinationId`: 組み合わせID
- `score`: 評価スコア（1-5）
- `timestamp`: 回答日時
- `created_at`: 作成日時

## API エンドポイント

### 問題データ関連
- `GET /api/problems` - 問題データを取得
  - クエリパラメータ:
    - `limit`: 取得件数（デフォルト: 100）
    - `random`: ランダム取得（true/false、デフォルト: false）
- `GET /api/problems/stats` - 問題データの統計情報

### 評価結果関連
- `POST /api/judgments` - 評価結果を保存
- `GET /api/judgments` - 評価結果を取得
  - クエリパラメータ:
    - `userName`: 特定ユーザーの結果のみ取得
    - `limit`: 取得件数（デフォルト: 100）
- `GET /api/stats` - 評価結果の統計情報

## データの更新

新しい問題データを追加する場合：
```bash
node loadDataToDatabase.js <新しいCSVファイルのパス>
```

注意：既存のデータは削除され、新しいデータで置き換えられます。

## 特徴

- **自動問題読み込み**: データベースから問題が自動で読み込まれ、ランダムに提示される
- **リアルタイム保存**: 評価結果は即座にデータベースに保存される
- **オフライン対応**: ネットワークエラー時はローカルストレージに一時保存し、再接続時に自動送信
- **進捗表示**: 現在の進行状況が視覚的に表示される
- **データエクスポート**: 評価結果をCSV形式でダウンロード可能

## トラブルシューティング

### データベースファイルが見つからない
アプリケーション初回起動時に自動的に作成されます。

### 問題データが表示されない
1. データベースに問題データが正しく読み込まれているか確認
2. サーバーコンソールでエラーメッセージを確認

### 評価結果が保存されない
1. ネットワーク接続を確認
2. ブラウザの開発者ツールでエラーを確認
3. 一時保存されたデータは再接続時に自動送信される
